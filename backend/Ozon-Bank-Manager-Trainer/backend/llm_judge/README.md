# üß† `llm_judge` ‚Äî –ú–æ–¥—É–ª—å –æ—Ü–µ–Ω–∫–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã—Ö –¥–∏–∞–ª–æ–≥–æ–≤

–ú–æ–¥—É–ª—å `llm_judge` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–µ –∑–≤–æ–Ω–∫–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –≤ –≥–æ–ª–æ—Å–æ–≤–æ–º —Ç—Ä–µ–Ω–∞–∂—ë—Ä–µ Ozon Bank –ø–æ –ø—Ä–æ–¥–∞–∂–µ —Ä–∞—Å—á—ë—Ç–Ω–æ-–∫–∞—Å—Å–æ–≤–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è (–†–ö–û).  
–û–Ω –≤—ã–¥–∞—ë—Ç **—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é, –æ–±—ä–µ–∫—Ç–∏–≤–Ω—É—é –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–≤—è–∑—å**, –æ—Å–Ω–æ–≤–∞–Ω–Ω—É—é –Ω–∞:
- compliance-—Ñ—Ä–∞–∑–∞—Ö,
- —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø—Ä–æ–¥–∞–∂ (AIDA + —ç—Ç–∞–ø—ã),
- –Ω–∞–≤—ã–∫–∞—Ö –ø—Ä–æ–¥–∞–∂ (–≤–µ–∂–ª–∏–≤–æ—Å—Ç—å, —Ä–∞–±–æ—Ç–∞ —Å –≤–æ–∑—Ä–∞–∂–µ–Ω–∏—è–º–∏, —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å).

---

## üéØ –¶–µ–ª—å

–ó–∞–º–µ–Ω–∏—Ç—å —Ä—É—á–Ω–æ–π —Ä–∞–∑–±–æ—Ä –∑–≤–æ–Ω–∫–æ–≤ —Ç—Ä–µ–Ω–µ—Ä–æ–º –Ω–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é –∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º—É—é –æ—Ü–µ–Ω–∫—É**, –∫–æ—Ç–æ—Ä–∞—è:
- –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–±–ª—é–¥–µ–Ω–∏–µ compliance-—Ñ—Ä–∞–∑,
- –≤—ã—è–≤–ª—è–µ—Ç –æ—à–∏–±–∫–∏ —Å —Ç–∞–π–º–∫–æ–¥–∞–º–∏,
- –¥–∞—ë—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –Ω–∞–≤—ã–∫–æ–≤.

---

## üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
src/
‚îî‚îÄ‚îÄ llm_judge/
    ‚îú‚îÄ‚îÄ app.py          # FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    ‚îú‚îÄ‚îÄ database.py     # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –∏ –º–æ–¥–µ–ª—å TrainingSession
    ‚îú‚îÄ‚îÄ models.py       # Pydantic-–º–æ–¥–µ–ª–∏
    ‚îú‚îÄ‚îÄ judge.py        # –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∞—Å—Å LLMJudge
    ‚îú‚îÄ‚îÄ parser.py       # –ü–∞—Ä—Å–µ—Ä –æ—Ç–≤–µ—Ç–æ–≤ LLM
    ‚îú‚îÄ‚îÄ client_classifier.py # –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
    ‚îú‚îÄ‚îÄ backends/
    ‚îÇ   ‚îî‚îÄ‚îÄ ollama_backend.py
    ‚îú‚îÄ‚îÄ spec/
    ‚îÇ   ‚îú‚îÄ‚îÄ evaluation_spec.json
    ‚îÇ   ‚îî‚îÄ‚îÄ compliance_phrases.md
    ‚îî‚îÄ‚îÄ prompts/
        ‚îî‚îÄ‚îÄ judge_prompt.md
```

---

## üöÄ –ó–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- macOS 14 Sonoma –∏–ª–∏ –Ω–æ–≤–µ–µ (–¥–ª—è Ollama).
- Python 3.10+
- PostgreSQL

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Ollama: [https://ollama.com/download](https://ollama.com/download)
   - –¢—Ä–µ–±—É–µ—Ç—Å—è macOS 14 Sonoma –∏–ª–∏ –Ω–æ–≤–µ–µ.
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Ollama:

```bash
ollama serve
```

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
pip install -r requirements.txt
```

4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

```bash
uvicorn src.llm_judge.app:app --reload
```

---

## üß™ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- `/start_training` ‚Äî —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é —Å–µ—Å—Å–∏—é –≤ –ë–î.
- `/generate_client_response` ‚Äî –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç –ò–ò-–∫–ª–∏–µ–Ω—Ç–∞ (—á–µ—Ä–µ–∑ Ollama).
- `/evaluate` ‚Äî –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥, –∏—Å–ø–æ–ª—å–∑—É—è `LLMJudge`.
- `/sessions/{session_id}` ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ (–≤–∫–ª—é—á–∞—è –æ—Ü–µ–Ω–∫—É).

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç —á–µ—Ä–µ–∑ `curl`

```bash
curl -X 'POST' \
  'http://127.0.0.1:8000/start_training' \
  -H 'Content-Type: application/json' \
  -d '{
  "manager_id": "mgr_001",
  "scenario_id": "rko_call",
  "archetype": "new_seller",
  "difficulty": 2
}'
```

---

## üìã –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ `/evaluate`

```json
{
  "scores": {
    "greeting_correct": true,
    "compliance_free_account_ip": true
  },
  "total_score": 85,
  "critical_errors": [],
  "feedback_positive": ["–•–æ—Ä–æ—à–µ–µ –Ω–∞—á–∞–ª–æ –∑–≤–æ–Ω–∫–∞"],
  "feedback_improvement": ["–£—Ç–æ—á–Ω–∏—Ç–µ —Ç–∞—Ä–∏—Ñ—ã"],
  "compliance_check": {
    "–†–∞—Å—á–µ—Ç–Ω—ã–π —Å—á–µ—Ç –æ—Ç –û–∑–æ–Ω –ë–∞–Ω–∫–∞ ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–¥–∞–≤—Ü–æ–≤.": true
  }
}
```

---

## üß© –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

- **PostgreSQL** ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π –∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤.
- **Ollama** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –∏ –æ—Ü–µ–Ω–∫–∞ (–º–æ–¥–µ–ª–∏ `qwen2:1.5b` –∏ `qwen2:7b`).
- **Pydantic** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤.
- **SQLAlchemy** ‚Äî ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î.




